image: Visual Studio 2019
configuration: Release
platform: Any CPU

before_build:
  - nuget restore
  - dotnet restore

build:
  verbosity: minimal
  project: Cogito.SqlServer.Deployment.sln

before_test:
  - cmd: cd %TEMP%
  - cmd: appveyor DownloadFile https://download.microsoft.com/download/b/8/c/b8ce1000-2e0b-4bc8-b4e4-646e9a439525/SQL2019-SSEI-Dev.exe
  - cmd: mkdir SQL2019
  - cmd: .\SQL2019-SSEI-Dev.exe /Quiet /Action=Download /MediaType=CAB /MediaPath=%TEMP%\SQL2019
  - cmd: .\SQL2019\SQLServer2019-DEV-x64-ENU.exe /q /x:%TEMP%\SQL2019\media
  - ps: $x=gc Cogito.SqlServer.Deployment.runsettings; $x.RunSettings.TestRunParameters.Parameter[0].'@value'="$env:TEMP\SQL2019\media\setup.exe"; $x.Save("Cogito.SqlServer.Deployment.runsettings");

artifacts:
  - path: pkg\*.nupkg
    name: Cogito.SqlServer.Deployment

deploy:
  provider: NuGet
  server: https://nuget.pkg.github.com/wasabii/index.json
  username: wasabii
  api_key:
    secure: xrFuWmVqekabWUvYce7mOmKS4ToqdtFJOGgiLYyrDRVZJhMSMvpOUVxf0mhzwGiH
  skip_symbols: false
  symbol_server:
  artifact: /.*\.nupkg/
