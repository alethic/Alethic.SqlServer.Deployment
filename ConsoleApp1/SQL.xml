<Deployment>
    <Parameter Name="SetupExePath" DefaultValue="C:\Foo\SQLExpress\setup.exe" />
    <Parameter Name="SQL_InstanceName" DefaultValue="(localdb)\SQL01" />
    <Parameter Name="EFM_InstanceName" DefaultValue="(localdb)\EFM01" />
    <Parameter Name="DST_InstanceName" DefaultValue="(localdb)\DST01" />
    <Parameter Name="PathToJcmsDacPac" DefaultValue="C:\Foo\Bar\JCMS.dacpac" />
    <Parameter Name="PathToConversionDacPac" DefaultValue="C:\Foo\Bar\PathToConversionDacPac.dacpac" />
    <Parameter Name="PathToExchangeDacPac" DefaultValue="C:\Foo\Bar\PathToExchangeDacPac.dacpac" />
    <Target Name="DST">
        <Instance Name="[DST_InstanceName]">
            <Setup Exe="[SetupExePath]" />
            <Distributor />
        </Instance>
    </Target>
    <Target Name="SQL">
        <Instance Name="[SQL_InstanceName]">
            <Setup Exe="[SetupExePath]" />
            <Property Name="clr enabled" Value="1" />
        </Instance>
    </Target>
    <Target Name="EFM">
        <Instance Name="[EFM_InstanceName]">
            <Setup Exe="[SetupExePath]" />
            <Property Name="clr enabled" Value="1" />
        </Instance>
    </Target>
    <Target Name="SQL_TO_EFM">
        <DependsOn Name="SQL" />
        <DependsOn Name="EFM" />
        <Instance Name="[SQL_InstanceName]">
            <LinkedServer Name="NEON" Target="[EFM_InstanceName]" />
        </Instance>
    </Target>
    <Target Name="EFM_TO_SQL">
        <DependsOn Name="EFM" />
        <DependsOn Name="SQL" />
        <Instance Name="[EFM_InstanceName]">
            <LinkedServer Name="JCMS" Target="[SQL_InstanceName]" />
        </Instance>
    </Target>
    <Target Name="SQL_JCMS">
        <DependsOn Name="SQL" />
        <DependsOn Name="SQL_TO_EFM" />
        <Instance Name="[SQL_InstanceName]">
            <Database Name="JCMS" Package="[PathToJcmsDacPac]" />
            <Publication Name="JCMS" Database="JCMS" Distributor="[DST_InstanceName]" />
        </Instance>
    </Target>
    <Target Name="SQL_Conversion">
        <DependsOn Name="SQL" />
        <Instance Name="[SQL_InstanceName]">
            <Database Name="Conversion" Package="[PathToConversionDacPac]" />
        </Instance>
    </Target>
    <Target Name="EFM_JCMS">
        <DependsOn Name="EFM" />
        <DependsOn Name="SQL_JCMS" />
        <Instance Name="[EFM_InstanceName]">
            <Subscription Name="JCMS" Publisher="[SQL_InstanceName]" Publication="JCMS" />
        </Instance>
    </Target>
    <Target Name="EFM_Exchange">
        <DependsOn Name="EFM" />
        <Instance Name="[EFM_InstanceName]">
            <Database Name="Exchange">
                <Package Source="[PathToExchangeDacPac]">
                    <DeployOptions>
                        <SqlCommandVariableValues>
                            <SqlCommandVariableValue Name="Foo" Value="Bar" />
                        </SqlCommandVariableValues>
                    </DeployOptions>
                </Package>
            </Database>
        </Instance>
    </Target>
</Deployment>
